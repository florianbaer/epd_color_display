# Production docker-compose for EPD Color Display
# Runs both backend and frontend services

services:
  backend:
    build: ./backend
    container_name: epd-backend
    volumes:
      - ./prompt.md:/app/prompt.md
      - ./prompt_history.csv:/app/prompt_history.csv
      - ./generated_images:/app/generated_images
      - ./.env:/app/.env
      - /sys:/sys
    devices:
      - "/dev/gpiochip0:/dev/gpiochip0"
      - "/dev/spidev0.0:/dev/spidev0.0"
    environment:
      - TZ=${TZ:-Europe/Zurich}
      - SCHEDULE_TIME=${SCHEDULE_TIME:-19:00}
      - AUTO_GENERATE=${AUTO_GENERATE:-true}
    restart: unless-stopped
    privileged: true
    networks:
      - epd-network

  frontend:
    build: ./frontend
    container_name: epd-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - epd-network

networks:
  epd-network:
    driver: bridge
